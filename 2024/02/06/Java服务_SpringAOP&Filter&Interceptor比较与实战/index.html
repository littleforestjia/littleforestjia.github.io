<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
    
  
  <link href="https://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css" />







  

<link href="https://cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Spring,Filter,Interceptor," />










<meta name="description" content="Java服务_SpringAOP&amp;Filter&amp;Interceptor比较与实战一、SpringAOP1.SpringAOP概述1.1 AOP与SpringAOPAOP与Spring并不是一个强绑定的关系，AOP是指面向切面编程，是一种编程思想；SpringAOP是指Spring框架提供的一套AOP的快捷实现封装。AOP本省不是某种语言或某个框架特有的，它实现的是将横向逻辑与业务逻">
<meta property="og:type" content="article">
<meta property="og:title" content="Java服务_SpringAOP&amp;Filter&amp;Interceptor比较与实战">
<meta property="og:url" content="http://https//littleforestjia.github.io/2024/02/06/Java%E6%9C%8D%E5%8A%A1_SpringAOP&Filter&Interceptor%E6%AF%94%E8%BE%83%E4%B8%8E%E5%AE%9E%E6%88%98/index.html">
<meta property="og:site_name" content="岩手县小森的博客">
<meta property="og:description" content="Java服务_SpringAOP&amp;Filter&amp;Interceptor比较与实战一、SpringAOP1.SpringAOP概述1.1 AOP与SpringAOPAOP与Spring并不是一个强绑定的关系，AOP是指面向切面编程，是一种编程思想；SpringAOP是指Spring框架提供的一套AOP的快捷实现封装。AOP本省不是某种语言或某个框架特有的，它实现的是将横向逻辑与业务逻">
<meta property="og:image" content="http://littleforestjia.github.io/2024/02/06/Java%E6%9C%8D%E5%8A%A1_SpringAOP&Filter&Interceptor%E6%AF%94%E8%BE%83%E4%B8%8E%E5%AE%9E%E6%88%98/1.jpg">
<meta property="og:image" content="http://littleforestjia.github.io/2024/02/06/Java%E6%9C%8D%E5%8A%A1_SpringAOP&Filter&Interceptor%E6%AF%94%E8%BE%83%E4%B8%8E%E5%AE%9E%E6%88%98/3.jpg">
<meta property="og:image" content="http://littleforestjia.github.io/2024/02/06/Java%E6%9C%8D%E5%8A%A1_SpringAOP&Filter&Interceptor%E6%AF%94%E8%BE%83%E4%B8%8E%E5%AE%9E%E6%88%98/2.jpg">
<meta property="article:published_time" content="2024-02-05T16:00:00.000Z">
<meta property="article:modified_time" content="2024-04-04T08:48:50.617Z">
<meta property="article:author" content="zju岩手县小森">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Filter">
<meta property="article:tag" content="Interceptor">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://littleforestjia.github.io/2024/02/06/Java%E6%9C%8D%E5%8A%A1_SpringAOP&Filter&Interceptor%E6%AF%94%E8%BE%83%E4%B8%8E%E5%AE%9E%E6%88%98/1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://https://littleforestjia.github.io/2024/02/06/Java服务_SpringAOP&Filter&Interceptor比较与实战/"/>





  <title>Java服务_SpringAOP&Filter&Interceptor比较与实战 | 岩手县小森的博客</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">岩手县小森的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">努力将眼前的每一天过得精彩</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://https://littleforestjia.github.io/2024/02/06/Java%E6%9C%8D%E5%8A%A1_SpringAOP&Filter&Interceptor%E6%AF%94%E8%BE%83%E4%B8%8E%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zju岩手县小森">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岩手县小森的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java服务_SpringAOP&Filter&Interceptor比较与实战</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-02-06T00:00:00+08:00">
                2024-02-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index">
                    <span itemprop="name">Java服务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Java服务-SpringAOP-amp-Filter-amp-Interceptor比较与实战"><a href="#Java服务-SpringAOP-amp-Filter-amp-Interceptor比较与实战" class="headerlink" title="Java服务_SpringAOP&amp;Filter&amp;Interceptor比较与实战"></a>Java服务_SpringAOP&amp;Filter&amp;Interceptor比较与实战</h1><h2 id="一、SpringAOP"><a href="#一、SpringAOP" class="headerlink" title="一、SpringAOP"></a>一、SpringAOP</h2><h3 id="1-SpringAOP概述"><a href="#1-SpringAOP概述" class="headerlink" title="1.SpringAOP概述"></a>1.SpringAOP概述</h3><h4 id="1-1-AOP与SpringAOP"><a href="#1-1-AOP与SpringAOP" class="headerlink" title="1.1 AOP与SpringAOP"></a>1.1 AOP与SpringAOP</h4><p><strong>AOP与Spring并不是一个强绑定的关系，AOP是指面向切面编程，是一种编程思想；SpringAOP是指Spring框架提供的一套AOP的快捷实现封装。AOP本省不是某种语言或某个框架特有的，它实现的是将横向逻辑与业务逻辑解耦，实现对业务代码无侵入，从而让我们更专注于业务逻辑本身，本质是在不改变原有业务逻辑的情况下增强横切逻辑，在软件开发过程中，像权限、监控、日志、事务、异常重试等非业务主链路逻辑和业务代码混夹在一起就不够优雅，可以用AOP来实现。</strong></p>
<p>SpringAOP提供了三种AOP的快捷实现方式：</p>
<p>1）Spring1.2 基于接口的配置：Spring最早的AOP实现是完全基于接口，虽然兼容，但已经不推荐了。</p>
<p>2）Spring2.0+ schema-based 配置 ：Spring2.0之后，提供了 schema-based 配置，也就是xml的方式配置。</p>
<p>3）Spring2.0+ @Aspect配置：Spring2.0之后，也提供了 <code>@Aspect</code> 基于注解的实现方式，也就是本文的主角，也是目前最方便、最广泛使用的方式！</p>
<h4 id="1-2-Aspect简单案例快速入门"><a href="#1-2-Aspect简单案例快速入门" class="headerlink" title="1.2 @Aspect简单案例快速入门"></a>1.2 @Aspect简单案例快速入门</h4><p><code>@Aspect</code>注解方式，它的概念像@Aspect、@Pointcut、@Before、@After、@Around等注解都是来自于 AspectJ，但是功能的实现是纯SpringAOP自己实现的，主要有两大核心：</p>
<p>1）定义切入点：使用@Pointcut切点表达式。</p>
<p>2）定义切入时机和增强处理逻辑：五种通知Advice注解对切入点执行增强处理，包括：@Before、@After、@AfterRunning、@AfterThrowing、@Around。</p>
<p><strong>通过对切入点的定义就可以知道对哪些方法进行增强，通过对切入时机和增强逻辑的定义就可以知道在源方法的前面还是后面增加什么增强逻辑。</strong></p>
<p>pom.xml依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>AOP实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @Aspect和@Component定义一个切面类</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodLogAspect</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 核心一：定义切点(使用execution方式)</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.jd.bdaa.arch.dao.mapper.drive.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mapperMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 核心二：定义切入时机和增强处理(这是5种通知中的前置通知)</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"mapperMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知:"</span> + joinPoint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>经过上述处理，在com.jd.bdaa.arch.dao.mapper.drive这个包下的所有类中的所有方法执行前，都会先执行printLog()方法。</strong></p>
<h4 id="1-3-切面类中切点表达式的配置方式"><a href="#1-3-切面类中切点表达式的配置方式" class="headerlink" title="1.3 切面类中切点表达式的配置方式"></a>1.3 切面类中切点表达式的配置方式</h4><p><strong>切点表达式就是用来指定对哪些方法进行增强的表达式</strong>，切点表达式有如下三种配置方式：</p>
<p>1）内置配置</p>
<p>定义切入时机和增强处理时，直接在 <code>@Before</code> 或 <code>@AfterReturning</code> 等通知注解中指定切点表达式。<strong><code>切入时机和增强处理</code>又叫做<code>通知</code>。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @Aspect和@Component定义一个切面类</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodLogAspect</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 一步定义完成切点、切入时机和增强处理</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"execution(* com.jd.bdaa.arch.dao.mapper.drive.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知:"</span> + joinPoint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）注解配置</p>
<p>在切面类中，先定义一个方法并使用 <code>@Pointcut</code> 注解来指定切点表达式。然后在定义通知时，在通知注解中指定定义表达式的方法签名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @Aspect和@Component定义一个切面类</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodLogAspect</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 核心一：定义切点(使用execution方式)</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.jd.bdaa.arch.dao.mapper.drive.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mapperMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 核心二：定义切入时机和增强处理(这是5种通知中的前置通知)</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"mapperMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知:"</span> + joinPoint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3）公共配置</p>
<p>也可以将切点的定义和通知的定义分别放在两个不同的类中，实现切点表达式的共用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonPointCut</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.jd.bdaa.arch.dao.mapper.drive.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mapperMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodLogAspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"com.jd.bdaa.arch.aop.CommonPointCut.mapperMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知:"</span> + joinPoint);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-4-切点表达式类型"><a href="#1-4-切点表达式类型" class="headerlink" title="1.4 切点表达式类型"></a>1.4 切点表达式类型</h4><p><strong>切点表达式就是用来指定对哪些方法进行增强的表达式</strong>，SpringAOP目前支持如下十种切点表达式：</p>
<h5 id="1-4-1-execution"><a href="#1-4-1-execution" class="headerlink" title="1.4.1 execution"></a>1.4.1 execution</h5><p><strong>execution也是最常用的切点表达式类型，可以匹配方法、类、包。</strong></p>
<p>表达式模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(modifier? ret-type declaring-type?name-pattern(param-pattern) throws-pattern?)</span><br></pre></td></tr></table></figure>

<p>表达式解释：</p>
<ul>
<li><p>modifier：匹配修饰符，public, private 等，省略时匹配任意修饰符</p>
</li>
<li><p>ret-type：匹配返回类型，使用 * 匹配任意类型</p>
</li>
<li><p>declaring-type：匹配目标类，省略时匹配任意类型</p>
</li>
<li><ul>
<li>.. 匹配包及其子包的所有类</li>
</ul>
</li>
<li><p>name-pattern：匹配方法名称，使用 * 表示通配符</p>
</li>
<li><ul>
<li>* 匹配任意方法</li>
<li>set* 匹配名称以 set 开头的方法</li>
</ul>
</li>
<li><p>param-pattern：匹配参数类型和数量</p>
</li>
<li><ul>
<li>() 匹配没有参数的方法</li>
<li>(..) 匹配有任意数量参数的方法</li>
<li>(*) 匹配有一个任意类型参数的方法</li>
<li>(*,String) 匹配有两个参数的方法，并且第一个为任意类型，第二个为 String 类型</li>
</ul>
</li>
<li><p>throws-pattern：匹配抛出异常类型，省略时匹配任意类型</p>
</li>
</ul>
<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配public方法</span></span><br><span class="line">execution(<span class="keyword">public</span> * *(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配名称以set开头的方法</span></span><br><span class="line">execution(* set*(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配AccountService接口或类的方法</span></span><br><span class="line">execution(* com.xyz.service.AccountService.*(..))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配service包及其子包的类或接口</span></span><br><span class="line">execution(* com.xyz.service..*(..))</span><br></pre></td></tr></table></figure>

<p><strong>还可以使用&amp;&amp;、|| 和 ! 来组合多个切点表达式，表示多个表达式“与”、“或”和“非”的逻辑关系，提升匹配效率，示例如下</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut</span>(<span class="string">"!execution(* com.jd.bdaa.arch.dao.mapper.drive.DriveDataSourceRouteMapper.*(..))"</span> +</span><br><span class="line">            <span class="string">"&amp;&amp; !execution(* com.jd.bdaa.arch.dao.mapper.drive.DriveDataSourceRouteStrategyAppkeyMapper.*(..))"</span> +</span><br><span class="line">            <span class="string">"&amp;&amp; !execution(* com.jd.bdaa.arch.dao.mapper.drive.DriveDataSourceRouteStrategyMapper.*(..))"</span> +</span><br><span class="line">            <span class="string">"&amp;&amp; execution(* com.jd.bdaa.arch.dao.mapper.drive.*.*(..))"</span>)</span><br></pre></td></tr></table></figure>

<h5 id="1-4-2-within"><a href="#1-4-2-within" class="headerlink" title="1.4.2 within"></a>1.4.2 within</h5><p>匹配指定类型。匹配指定类的任意方法，不能匹配接口。</p>
<p>表达式模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">within(declaring-type)</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配service包的类</span></span><br><span class="line">within(com.xyz.service.*)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配service包及其子包的类</span></span><br><span class="line">within(com.xyz.service..*)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配AccountServiceImpl类</span></span><br><span class="line">within(com.xyz.service.AccountServiceImpl)</span><br></pre></td></tr></table></figure>

<h5 id="1-4-3-this"><a href="#1-4-3-this" class="headerlink" title="1.4.3 this"></a>1.4.3 this</h5><p>匹配代理对象实例的类型，匹配在运行时对象的类型。</p>
<blockquote>
<p><strong>注意：</strong>基于 JDK 动态代理实现的 AOP，this 不能匹配接口的实现类，因为代理类和实现类并不是同一种类型，详情参阅《<a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/ecsVekuGTjw6rwBf90-j_Q">Spring中的AOP和动态代理</a>》</p>
</blockquote>
<p>表达式模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this(declaring-type)</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配代理对象类型为service包下的类</span></span><br><span class="line"><span class="keyword">this</span>(com.xyz.service.*)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配代理对象类型为service包及其子包下的类</span></span><br><span class="line"><span class="keyword">this</span>(com.xyz.service..*)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配代理对象类型为AccountServiceImpl的类</span></span><br><span class="line"><span class="keyword">this</span>(com.xyz.service.AccountServiceImpl)</span><br></pre></td></tr></table></figure>

<h5 id="1-4-4-target"><a href="#1-4-4-target" class="headerlink" title="1.4.4 target"></a>1.4.4 target</h5><p>匹配目标对象实例的类型，匹配 AOP 被代理对象的类型。</p>
<p>表达式模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target(declaring-type)</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配目标对象类型为service包下的类</span></span><br><span class="line">target(com.xyz.service.*)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配目标对象类型为service包及其子包下的类</span></span><br><span class="line">target(com.xyz.service..*)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配目标对象类型为AccountServiceImpl的类</span></span><br><span class="line">target(com.xyz.service.AccountServiceImpl</span><br></pre></td></tr></table></figure>

<p>三种表达式匹配范围如下：</p>
<table>
<thead>
<tr>
<th>表达式匹配范围</th>
<th>within</th>
<th>this</th>
<th>target</th>
</tr>
</thead>
<tbody><tr>
<td>接口</td>
<td>✘</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td>实现接口的类</td>
<td>✔</td>
<td>〇</td>
<td>✔</td>
</tr>
<tr>
<td>不实现接口的类</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
</tbody></table>
<h5 id="1-4-5-args"><a href="#1-4-5-args" class="headerlink" title="1.4.5 args"></a>1.4.5 args</h5><p>匹配方法参数类型和数量，参数类型可以为指定类型及其子类。</p>
<blockquote>
<p>使用 execution 表达式匹配参数时，不能匹配参数类型为子类的方法。</p>
</blockquote>
<p>表达式模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args(param-pattern)</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配参数只有一个且为Serializable类型（或实现Serializable接口的类）</span></span><br><span class="line">args(java.io.Serializable)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配参数个数至少有一个且为第一个为Example类型（或实现Example接口的类）</span></span><br><span class="line">args(cn.codeartist.spring.aop.pointcut.Example,..)</span><br></pre></td></tr></table></figure>

<h5 id="1-4-6-bean"><a href="#1-4-6-bean" class="headerlink" title="1.4.6 bean"></a>1.4.6 bean</h5><p>通过 bean 的 id 或名称匹配，支持 * 通配符。</p>
<p>表达式模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bean(bean-name)</span><br></pre></td></tr></table></figure>

<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配名称以Service结尾的bean</span></span><br><span class="line">bean(*Service)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配名称为demoServiceImpl的bean</span></span><br><span class="line">bean(demoServiceImpl)</span><br></pre></td></tr></table></figure>

<h5 id="1-4-7-annotation"><a href="#1-4-7-annotation" class="headerlink" title="1.4.7 @annotation"></a>1.4.7 @annotation</h5><p><strong>匹配方法是否含有注解，当方法上使用了指定注解，该方法会被匹配，在接口方法上使用注解不匹配。这也是SpringAOP最常用的一种切点表达式，使用该类型通常还需要开发者另外新建一个对应的注解类。</strong></p>
<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配使用了Demo注解的方法</span></span><br><span class="line"><span class="meta">@annotation</span>(cn.codeartist.spring.aop.pointcut.Demo)</span><br></pre></td></tr></table></figure>

<p><strong>还需要创建一个对应的注解类：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Demo &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-4-8-within"><a href="#1-4-8-within" class="headerlink" title="1.4.8 @within"></a>1.4.8 @within</h5><p>匹配指定类型是否含有注解，当定义类时使用了注解，该类的方法会被匹配，但在接口上使用注解不匹配。</p>
<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配使用了Demo注解的类</span></span><br><span class="line"><span class="meta">@within</span>(cn.codeartist.spring.aop.pointcut.Demo)</span><br></pre></td></tr></table></figure>

<h5 id="1-4-9-target"><a href="#1-4-9-target" class="headerlink" title="1.4.9 @target"></a>1.4.9 @target</h5><p>匹配目标对象实例的类型是否含有注解，当运行时对象实例的类型使用了注解，该类的方法会被匹配，在接口上使用注解不匹配。</p>
<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配对象实例使用了Demo注解的类</span></span><br><span class="line"><span class="meta">@target</span>(cn.codeartist.spring.aop.pointcut.Demo)</span><br></pre></td></tr></table></figure>

<h5 id="1-4-10-args"><a href="#1-4-10-args" class="headerlink" title="1.4.10 @args"></a>1.4.10 @args</h5><p>匹配方法参数类型是否含有注解。当方法的参数类型上使用了注解，该方法会被匹配。</p>
<p>使用示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配参数只有一个且参数类使用了Demo注解</span></span><br><span class="line"><span class="meta">@args</span>(cn.codeartist.spring.aop.pointcut.Demo)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匹配参数个数至少有一个且为第一个参数类使用了Demo注解</span></span><br><span class="line"><span class="meta">@args</span>(cn.codeartist.spring.aop.pointcut.Demo,..)</span><br></pre></td></tr></table></figure>

<h5 id="1-4-11-切点表达式组合"><a href="#1-4-11-切点表达式组合" class="headerlink" title="1.4.11 切点表达式组合"></a>1.4.11 切点表达式组合</h5><p>使用 &amp;&amp;、|| 和 ! 来组合多个切点表达式，表示多个表达式“与”、“或”和“非”的逻辑关系。</p>
<p>这可以用来组合多种类型的表达式，来提升匹配效率。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配doExecution()切点表达式并且参数第一个为Account类型的方法</span></span><br><span class="line"><span class="meta">@Before</span>(<span class="string">"doExecution() &amp;&amp; args(account,..)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validateAccount</span><span class="params">(Account account)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 自定义逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="1-5-通知类型与语法"><a href="#1-5-通知类型与语法" class="headerlink" title="1.5 通知类型与语法"></a>1.5 通知类型与语法</h4><p><strong>通知(Advice)就是切入点和增强逻辑。</strong>SpringAOP共有五种切入点类型：</p>
<p>@Before：前置通知，在被切的方法执行前执行；</p>
<p>@After：后置通知，在被切的方法return后执行，无论被切方法是否异常都会执行；</p>
<p>@AfterRunning：返回通知，在被切的方法return后执行，带有返回值，如果被切方法抛出异常则不会执行；</p>
<p>@AfterThrowing：异常通知，只被切的方法抛异常时执行，否则不执行；</p>
<p>@Around：环绕通知，这是功能最强大的Advice，可以自定义执行顺序。</p>
<p>这五种切入点的执行顺序如下：</p>
<p><img src="//littleforestjia.github.io/2024/02/06/Java%E6%9C%8D%E5%8A%A1_SpringAOP&Filter&Interceptor%E6%AF%94%E8%BE%83%E4%B8%8E%E5%AE%9E%E6%88%98/1.jpg" alt></p>
<p>方法语法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> 方法名(JoinPoint joinPoint) &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@After</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> 方法名(JoinPoint joinPoint) &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterReturning</span>(value = <span class="string">"pointCut()"</span>, returning = <span class="string">"result"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterThrowing</span>(value = <span class="string">"pointCut()"</span>, throwing = <span class="string">"e"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(JoinPoint joinPoint, Exception e)</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Around</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<p><strong>增强逻辑的方法名可以随意自定义，但是出参数和入参类型是固定写法。</strong></p>
<p><strong>上述JoinPoint类型入参连接点非常重要，因为Spring只支持方法类型的连接点，所以在Spring中joinPoint指的就是被增强的源方法。</strong>JoinPoint连接点类型中有三个常用的方法：</p>
<p>1）getSignature()获取签名：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MethodSignature signature = (MethodSignature) joinPoint.getSignature();</span><br></pre></td></tr></table></figure>

<p>通过signature实例可以获取名称getName() 和参数类型getParameterTypes()。</p>
<p>2）getTarget()获取目标类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = joinPoint.getTarget().getClass();</span><br></pre></td></tr></table></figure>

<p>如果被增强的类是被别的切面切过的类，可以使用AopUtils.getTargetClass获取一个数组，再从数组中找你期望的类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.aop.support.AopUtils;</span><br><span class="line">Class&lt;?&gt;[] targets = AopUtils.getTargetClass(joinPoint.getTarget()).getInterfaces();</span><br></pre></td></tr></table></figure>

<p>3）getArgs()获取入参值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object[] args = joinPoint.getArgs()</span><br></pre></td></tr></table></figure>

<p><strong>基于上述3个方法，可以轻松获取到被增强的类名、方法名、方法参数类型、方法参数值等。</strong>printMethod方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printMethod</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> NoSuchMethodException </span>&#123;</span><br><span class="line">    MethodSignature signature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">    Class&lt;?&gt; clazz = joinPoint.getTarget().getClass();</span><br><span class="line">    Method method = clazz.getMethod(signature.getName(), signature.getParameterTypes());</span><br><span class="line">    System.out.printf(<span class="string">"[MethodLogAspect]切面打印 -&gt; [className]:%s  -&gt;  [methodName]:%s  -&gt;  [methodArgs]:%s%n"</span>, clazz.getName(), method.getName(), Arrays.toString(joinPoint.getArgs()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-定义驱动AOP实战实例"><a href="#2-定义驱动AOP实战实例" class="headerlink" title="2.定义驱动AOP实战实例"></a>2.定义驱动AOP实战实例</h3><p>比较多，选两个比较典型的，公共配置自动同步生产AOP、调用外部系统监控AOP</p>
<h4 id="2-1-公共配置自动同步生产AOP"><a href="#2-1-公共配置自动同步生产AOP" class="headerlink" title="2.1 公共配置自动同步生产AOP"></a>2.1 公共配置自动同步生产AOP</h4><p><strong>定义驱动中的逻辑表是需要区分预发和线上的，所以分了两个mysql库，这个设置其实不太合理，但是已经这样用了，那么有一些公共配置项目就需要在预发环境配置好了之后直接同步到生产环境，如数据源、数据集之类的，这使用就需要用到这个预发自动同步生产AOP，将预发环境的增删改方法增强生产环境增删改逻辑。</strong></p>
<p>这个AOP采用的是@annotation类型的切点表达式，所以需要先注册一个注解类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD&#125;)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> PreInvokeProd &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建切面类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"config"</span>, name = <span class="string">"env"</span>, havingValue = <span class="string">"PRE"</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreInvokeProdAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UmpInfo umpInfo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DriveMetaProdService driveMetaProdService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"@annotation(com.jd.bdaa.arch.annotation.PreInvokeProd)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">aroundMethod</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        String interfaceName = joinPoint.getTarget().getClass().getInterfaces()[<span class="number">0</span>].getSimpleName();</span><br><span class="line">        String methodName = joinPoint.getSignature().getName();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Object res = joinPoint.proceed();</span><br><span class="line">            log.info(<span class="string">"execute preInvokeProd class &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;"</span>, interfaceName, methodName, JsonUtil.toJsonString(joinPoint.getArgs()), res);</span><br><span class="line">            driveMetaProdService.getMethod(interfaceName + <span class="string">":"</span> + methodName).invoke(driveMetaProdService.getService(interfaceName), joinPoint.getArgs());</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> CommonException || e <span class="keyword">instanceof</span> com.jd.bdaa.arch.error.exception.CommonException</span><br><span class="line">                || e <span class="keyword">instanceof</span> BizHandleException || e <span class="keyword">instanceof</span> ParamException || e <span class="keyword">instanceof</span> ExternalApiException) &#123;</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">            log.error(<span class="string">"execute preInvokeProd failed, service:&#123;&#125;, method:&#123;&#125;. exception:"</span>, interfaceName, methodName, e);</span><br><span class="line">            UmpUtil.makeAlarm(umpInfo, PARAM_HANDLER_ERROR, <span class="string">"预发同步生产报错。uuid = "</span> + MDC.get(Constants.LOG_UUID_KEY));</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CommonException(<span class="string">"数据同步异常"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在目标增强方法上添加对应注解即可生效：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除数据源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@PreInvokeProd</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">deleteDataSource</span><span class="params">(String erp, String dataSource)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    DriveEzdDataSourcePO dataSourcePO = driveEzdDataSourceService.getDataSourceByDatasource(dataSource);</span><br><span class="line">    <span class="keyword">return</span> deleteDataSource(erp, dataSourcePO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-2-调用外部系统监控AOP"><a href="#2-2-调用外部系统监控AOP" class="headerlink" title="2.2 调用外部系统监控AOP"></a>2.2 调用外部系统监控AOP</h4><p><strong>定义驱动依赖调用了多个下游系统，如ezd服务等，那么调用了哪些外部系统，调用参数等都希望统一打印到日志中，辅助跨服务联调，在故障排查、责任划分时有清晰明了的依据，这就需要这样一个AOP进行统一的日志打印。</strong></p>
<p>使用execution类型的切点表达式，并通过逻辑运算符指定某几个类中的方法，指定类上的方法直接就增强了，不需要另外在添加什么代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@DependsOn</span>(<span class="string">"duccConfig"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsfMethodAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(MapperMethodAspect<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String UMP_KEY = <span class="string">"drive_local_cache_aop_jsf"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DuccConfig duccConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"!execution(* com.jd.bdaa.arch.external.MenuOpenQueryExternalService.*(..))"</span> +</span><br><span class="line">            <span class="string">"&amp;&amp; !execution(* com.jd.bdaa.arch.external.EasyDataExternalService.*(..))"</span> +</span><br><span class="line">            <span class="string">"&amp;&amp; execution(* com.jd.bdaa.arch.external.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jsfMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"jsfMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeMapperMethod</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (duccConfig.getRouteLocalCacheEnable()) &#123;</span><br><span class="line">            MethodSignature signature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">            String clzName = signature.getDeclaringType().getSimpleName();</span><br><span class="line">            DriveRouteContext routeContext = DriveRouteMonitorUtil.getDriveRouteContextFromSystem();</span><br><span class="line">            StackTraceElement[] stackTrace = Thread.currentThread().getStackTrace();</span><br><span class="line">            StringBuffer stackTraceBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stackTrace.length; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (stackTrace[i].toString().startsWith(<span class="string">"com.jd.bdaa"</span>)) &#123;</span><br><span class="line">                    stackTraceBuffer.append(stackTrace[i]).append(<span class="string">"--&gt;"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (Objects.isNull(routeContext)) &#123;</span><br><span class="line">                <span class="comment">// 代表配置链路</span></span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(<span class="string">"JsfMethodAspect get mapper execute info. keys=&#123;clzName,methodName,stackTracePath&#125;"</span>, clzName, signature.getName(), stackTraceBuffer);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 代表查询路由链路</span></span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"JsfMethodAspect get mapper execute info. keys=&#123;clzName,methodName,stackTracePath,alias,resAppkey,serviceId,uuid&#125;"</span>, clzName, signature.getName(),</span><br><span class="line">                        stackTraceBuffer, routeContext.getAlias(), routeContext.getResAppKey(), routeContext.getServiceId(), routeContext.getUuid());</span><br><span class="line">            &#125;</span><br><span class="line">            String detail = String.format(<span class="string">"JsfMethodAspect get mapper execute info. %s ,%s ,%s ,%s ,%s ,%s ,%s "</span>, clzName, signature.getName(),</span><br><span class="line">                    stackTraceBuffer, routeContext.getAlias(), routeContext.getResAppKey(), routeContext.getServiceId(), routeContext.getUuid());</span><br><span class="line">            UmpUtil.alarm(UMP_KEY, detail);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="二、Filter过滤器"><a href="#二、Filter过滤器" class="headerlink" title="二、Filter过滤器"></a>二、Filter过滤器</h2><h3 id="1-Filter过滤器简介"><a href="#1-Filter过滤器简介" class="headerlink" title="1.Filter过滤器简介"></a>1.Filter过滤器简介</h3><p>Filter过滤器是在Servlet的规范中定义的，依赖于Servlet容器的组件，但不依赖于任何框架。</p>
<p>Filter过滤器只可以获取到请求中的Request和Response，无法获取到处理请求的方法的信息。</p>
<p>Filter过滤器是通过回调函数实现的。</p>
<h3 id="2-代码示例"><a href="#2-代码示例" class="headerlink" title="2.代码示例"></a>2.代码示例</h3><p>以下仅为简单示例case，要真正使用还有很多复杂配置，还有xml、注解等不同配置方式。</p>
<p>创建过滤器，同时配置过滤资源路径：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@WebFilter</span>(value = <span class="string">"/name"</span>) <span class="comment">//这里我们只拦截name请求，记得要在启动类配ServletComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		log.info(<span class="string">"before filter"</span>);</span><br><span class="line">		<span class="comment">// 请求放行</span></span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">		log.info(<span class="string">"after filter"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建Controller，也就是过滤器起作用的目标资源路径：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/name"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		log.info(<span class="string">"getName"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"sticki"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-多个过滤器执行顺序"><a href="#3-多个过滤器执行顺序" class="headerlink" title="3.多个过滤器执行顺序"></a>3.多个过滤器执行顺序</h3><p>当对同一个资源路径配置了多个过滤器时，可以使用多种方法控制过滤器的执行顺序。如在web.xml配置中谁定义在前，谁先执行；如Order注解配置优先级，值小的先执行；如通过Ordered接口指定优先级。</p>
<h2 id="三、Interceptor拦截器"><a href="#三、Interceptor拦截器" class="headerlink" title="三、Interceptor拦截器"></a>三、Interceptor拦截器</h2><h3 id="1-Interceptor拦截器简介"><a href="#1-Interceptor拦截器简介" class="headerlink" title="1.Interceptor拦截器简介"></a>1.Interceptor拦截器简介</h3><p>Interceptor拦截器是Spring框架的组件，依赖于Spring，但不依赖于Servlet。</p>
<p>Interceptor拦截器可以通过DI(依赖注入)的方式获取到Spring中存在的Bean，也可以获取到请求的上下文信息，如被拦截请求方法和类信息等。</p>
<p>Interceptor拦截器通过反射实现，本质是动态代理，也是运用了AOP的编程思想。</p>
<h3 id="2-代码示例-1"><a href="#2-代码示例-1" class="headerlink" title="2.代码示例"></a>2.代码示例</h3><p>以下仅为简单示例case，要真正使用还有很多复杂配置，还有xml、注解等不同配置方式。</p>
<p>创建拦截器，<strong>注意拦截器的preHandle()方法返回值为true时，请求才可以通过拦截器，返回值为false时，请求不能通过拦截器，即被拦截器拦截</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> </span>&#123;</span><br><span class="line">		log.info(<span class="string">"before interceptor"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> </span>&#123;</span><br><span class="line">		log.info(<span class="string">"after interceptor"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建拦截器配置类，用于配置需要拦截的资源路径：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 只拦截 age 的请求</span></span><br><span class="line">		registry.addInterceptor(<span class="keyword">new</span> MyInterceptor()).addPathPatterns(<span class="string">"/age"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建Controller，也就是过滤器起作用的目标资源路径：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">"/age"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		log.info(<span class="string">"getAge"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"18"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-多个拦截器执行顺序"><a href="#3-多个拦截器执行顺序" class="headerlink" title="3.多个拦截器执行顺序"></a>3.多个拦截器执行顺序</h3><p>当对同一个资源路径配置了多个拦截器时，可以使用多种方法控制拦截器的执行顺序。如在拦截器配置类对同一个资源路径先添加哪个拦截器，哪个先执行；如使用InterceptorRegistrationd的order()方法配置优先级，值小的先执行。</p>
<h2 id="四、过滤器、拦截器、SpringAOP、ControllerAdvcie对比与执行顺序"><a href="#四、过滤器、拦截器、SpringAOP、ControllerAdvcie对比与执行顺序" class="headerlink" title="四、过滤器、拦截器、SpringAOP、ControllerAdvcie对比与执行顺序"></a>四、过滤器、拦截器、SpringAOP、ControllerAdvcie对比与执行顺序</h2><h3 id="1-执行顺序"><a href="#1-执行顺序" class="headerlink" title="1.执行顺序"></a>1.执行顺序</h3><p>除了上述所说的过滤器、拦截器、SpringAOP，Spring中还有一个封装好组件也是通过AOP对Controller进行增强，那就是ControllerAdvice，该组件常用于全局异常处理(配合自定义异常效果更佳)、数据绑定、数据预处理等操作，我的全局异常处理博文中提有专门提过。</p>
<p>那么这四者都可以用于对Controller进行增强，其执行顺序如下：Filter过滤器 &gt; Interceptor拦截器 &gt; ControllerAdvice &gt; AOP &gt; Controller。</p>
<p><strong>注意，当抛出的异常被ControllerAdvice捕获之后，Interceptor拦截器不会再有后置处理了，但是Filter过滤器还是有后置处理的</strong>。</p>
<p><img src="//littleforestjia.github.io/2024/02/06/Java%E6%9C%8D%E5%8A%A1_SpringAOP&Filter&Interceptor%E6%AF%94%E8%BE%83%E4%B8%8E%E5%AE%9E%E6%88%98/3.jpg" alt></p>
<h3 id="2-过滤器、拦截器与RPC浅析"><a href="#2-过滤器、拦截器与RPC浅析" class="headerlink" title="2.过滤器、拦截器与RPC浅析"></a>2.过滤器、拦截器与RPC浅析</h3><p><img src="//littleforestjia.github.io/2024/02/06/Java%E6%9C%8D%E5%8A%A1_SpringAOP&Filter&Interceptor%E6%AF%94%E8%BE%83%E4%B8%8E%E5%AE%9E%E6%88%98/2.jpg" alt></p>
<p><strong>上文中所提到的Filter和Interceptor是指一般大家常用的基于Servlet或Spring已经定义封装好的工具组件，也就是只能用于WebService中的组件，或者说是只能用于Controller层组件。</strong></p>
<p><strong>RPC(远程过程调用)的使用范围和实现方式非常之广，RPC按通信协议可以分为基于HTTP的、基于TCP等；按报文协议可以分为基于XML文本的、基于JSON文本的，二进制的；按是否跨平台语言，可以分为平台专用的，平台中立的。WebService只是RPC的一种实现方式，一般应用于基于HTTP的、XML文本的、跨平台的、功能完善的业务系统。</strong></p>
<p><strong>那么对于WebService类型以外的RPC同样需要类似的Filter和Interceptor功能组件，归根结底它们都是AOP罢了，只不过在WebService中有一套已经封装好的组件，并定义好执行顺序等规则。那么对于任意的RPC协议，甚至是同一个微服务内部，任意研发人员都可以自己实现一套’过滤器’或’拦截器’。</strong></p>
<p>如阿里的dobbo、hsf、京东的jsf等RPC协议都封装支持了Filter过滤器组件，并提供了一些可以直接使用的Filter实现类。</p>
<h3 id="3-京东jsf协议过滤器使用实战"><a href="#3-京东jsf协议过滤器使用实战" class="headerlink" title="3.京东jsf协议过滤器使用实战"></a>3.京东jsf协议过滤器使用实战</h3><p>创建并实现一个日志打印Filter类，从其上游接口所属包也可以看出这是一个京东完全自建的过滤器类，从其方法体中也可以看出就是一个自行实现的AOP：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jd.jsf.gd.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jd.jsf.gd.msg.RequestMessage;</span><br><span class="line"><span class="keyword">import</span> com.jd.jsf.gd.msg.ResponseMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function">ResponseMessage <span class="title">invoke</span><span class="params">(RequestMessage var1)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsfLogMessageInterceptor</span> <span class="keyword">extends</span> <span class="title">AbstractFilter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(JsfLogMessageInterceptor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JsfLogMessageInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseMessage <span class="title">invoke</span><span class="params">(RequestMessage requestMessage)</span> </span>&#123;</span><br><span class="line">        Object[] originalArgs = requestMessage.getInvocationBody().getArgs();</span><br><span class="line">        String args = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            args = <span class="keyword">this</span>.objectMapper.writeValueAsString(originalArgs);</span><br><span class="line">            <span class="keyword">if</span> (args.length() &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                args = args.substring(<span class="number">0</span>, <span class="number">100</span>) + <span class="string">"..."</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var22) &#123;</span><br><span class="line">            LOGGER.warn(<span class="string">"Failed to process args json"</span>, var22);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;Byte, Object&gt; headers = requestMessage.getMsgHeader().getAttrMap();</span><br><span class="line">        String className = requestMessage.getClassName();</span><br><span class="line">        String methodName = requestMessage.getMethodName();</span><br><span class="line">        String alias = requestMessage.getAlias();</span><br><span class="line">        <span class="keyword">long</span> receiveTime = requestMessage.getReceiveTime();</span><br><span class="line">        String receiveTimeStr = DateUtils.dateToStr(<span class="keyword">new</span> Date(), <span class="string">"yyyy-MM-dd HH:mm:ss.SSS"</span>);</span><br><span class="line">        LOGGER.info(<span class="string">"Received JSF message. keys=&#123;className,methodName,alias,receiveTime,receiveTimeStr,headers,args&#125;"</span>, <span class="keyword">new</span> Object[]&#123;className, methodName, alias, receiveTime, receiveTimeStr, headers, args&#125;);</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        ResponseMessage response = <span class="keyword">this</span>.getNext().invoke(requestMessage);</span><br><span class="line">        <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line">        String invokedTime = DateUtils.dateToStr(<span class="keyword">new</span> Date(endTime), <span class="string">"yyyy-MM-dd HH:mm:ss.SSS"</span>);</span><br><span class="line">        String result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                result = <span class="keyword">this</span>.objectMapper.writeValueAsString(response.getResponse());</span><br><span class="line">                <span class="keyword">if</span> (result.length() &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                    result = result.substring(<span class="number">0</span>, <span class="number">100</span>) + <span class="string">"..."</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var21) &#123;</span><br><span class="line">                LOGGER.warn(<span class="string">"Failed to process response json"</span>, var21);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> isProvider = RpcContext.getContext().isProviderSide();</span><br><span class="line">        <span class="keyword">if</span> (isProvider) &#123;</span><br><span class="line">            AppInfo providerAppInfo = <span class="keyword">this</span>.getProviderAppInfo();</span><br><span class="line">            AppInfo consumerAppInfo = <span class="keyword">this</span>.getConsumerAppInfo();</span><br><span class="line">            LOGGER.info(<span class="string">"JSF invoked. keys=&#123;className,methodName,alias,receiveTime,receiveTimeStr,invokedTime,costTime,headers,args,response,isProvider,appIdProvider,appNameProvider,appIdConsumer,appNameConsumer&#125;"</span>, <span class="keyword">new</span> Object[]&#123;className, methodName, alias, receiveTime, receiveTimeStr, invokedTime, endTime - startTime, headers, args, result, isProvider, providerAppInfo.getAppId(), providerAppInfo.getAppName(), consumerAppInfo.getAppId(), consumerAppInfo.getAppName()&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LOGGER.info(<span class="string">"JSF invoked. keys=&#123;className,methodName,alias,receiveTime,receiveTimeStr,invokedTime,costTime,headers,args,response&#125;"</span>, <span class="keyword">new</span> Object[]&#123;className, methodName, alias, receiveTime, receiveTimeStr, invokedTime, endTime - startTime, headers, args, result&#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (response != <span class="keyword">null</span> &amp;&amp; response.isError()) &#123;</span><br><span class="line">            LOGGER.error(<span class="string">"Response JSF error. className: "</span> + className + <span class="string">", methodName: "</span> + methodName, response.getException());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> AppInfo <span class="title">getProviderAppInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String appIdCurrent = String.valueOf(JSFContext.get(<span class="string">"appId"</span>));</span><br><span class="line">        String appNameCurrent = String.valueOf(JSFContext.get(<span class="string">"appName"</span>));</span><br><span class="line">        String appInsIdCurrent = String.valueOf(JSFContext.get(<span class="string">"appInsId"</span>));</span><br><span class="line">        AppInfo appInfo = <span class="keyword">new</span> AppInfo(appIdCurrent, appNameCurrent, appInsIdCurrent);</span><br><span class="line">        <span class="keyword">return</span> appInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> AppInfo <span class="title">getConsumerAppInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String appIdConsumer = String.valueOf(RpcContext.getContext().getAttachment(<span class="string">".appId"</span>));</span><br><span class="line">        String appNameConsumer = String.valueOf(RpcContext.getContext().getAttachment(<span class="string">".appName"</span>));</span><br><span class="line">        String appInsIdConsumer = String.valueOf(RpcContext.getContext().getAttachment(<span class="string">".appInsId"</span>));</span><br><span class="line">        AppInfo appInfo = <span class="keyword">new</span> AppInfo(appIdConsumer, appNameConsumer, appInsIdConsumer);</span><br><span class="line">        <span class="keyword">return</span> appInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在jsf配置文件中为生产方和消费方配置自定义的Filter实现类：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--生产者--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jsf:provider</span> <span class="attr">id</span>=<span class="string">"metaDataService"</span> <span class="attr">interface</span>=<span class="string">"com.jd.bdaa.arch.provider.service.MetaDataService"</span> <span class="attr">alias</span>=<span class="string">"$&#123;jsf.alias.meta&#125;"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">ref</span>=<span class="string">"metaDataServiceImpl"</span> <span class="attr">server</span>=<span class="string">"meta-data-center-jsf-server"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">filter</span>=<span class="string">"jsfMdcInterceptor, jsfLogMessageInterceptor"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--消费者--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jsf:consumer</span> <span class="attr">id</span>=<span class="string">"dataAssetMetaService"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">interface</span>=<span class="string">"com.jd.bdaa.arch.meta.provider.service.DataAssetMetaService"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">protocol</span>=<span class="string">"jsf"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">alias</span>=<span class="string">"$&#123;jsf.metaDataPull.alias&#125;"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">serialization</span>=<span class="string">"hessian"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">timeout</span>=<span class="string">"10000"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">filter</span>=<span class="string">"jsfMdcInterceptor, jsfLogMessageInterceptor"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://blog.csdn.net/scm_2008/article/details/128593857" target="_blank" rel="noopener">【Spring AOP】@Aspect结合案例详解（一）: @Pointcut使用@annotation + 五种通知Advice注解（已附源码）</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Spring/" rel="tag"><i class="fa fa-tag"></i> Spring</a>
          
            <a href="/tags/Filter/" rel="tag"><i class="fa fa-tag"></i> Filter</a>
          
            <a href="/tags/Interceptor/" rel="tag"><i class="fa fa-tag"></i> Interceptor</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2024/02/05/Java%E6%9C%8D%E5%8A%A1_Redis%E5%AE%9E%E7%8E%B0%E9%99%90%E6%B5%81%E4%B8%8E%E9%94%81%E7%AD%96%E7%95%A5/" rel="next" title="Java服务_Redis实现限流与锁策略">
                <i class="fa fa-chevron-left"></i> Java服务_Redis实现限流与锁策略
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2024/02/07/Java%E6%9C%8D%E5%8A%A1_Spring%E4%BA%8B%E7%89%A9%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" rel="prev" title="Java服务_Spring事物与分布式事务">
                Java服务_Spring事物与分布式事务 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/head.jpg"
                alt="zju岩手县小森" />
            
              <p class="site-author-name" itemprop="name">zju岩手县小森</p>
              <p class="site-description motion-element" itemprop="description">看的远固然重要 但是走好眼前的路才是关键</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">157</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">139</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.instagram.com/littleforestjia" target="_blank" title="Instagram">
                      Instagram</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://space.bilibili.com/29623500" target="_blank" title="Bilibili">
                      Bilibili</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Java服务-SpringAOP-amp-Filter-amp-Interceptor比较与实战"><span class="nav-number">1.</span> <span class="nav-text">Java服务_SpringAOP&amp;Filter&amp;Interceptor比较与实战</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、SpringAOP"><span class="nav-number">1.1.</span> <span class="nav-text">一、SpringAOP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-SpringAOP概述"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.SpringAOP概述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-AOP与SpringAOP"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">1.1 AOP与SpringAOP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-Aspect简单案例快速入门"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">1.2 @Aspect简单案例快速入门</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-切面类中切点表达式的配置方式"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">1.3 切面类中切点表达式的配置方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-切点表达式类型"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">1.4 切点表达式类型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-1-execution"><span class="nav-number">1.1.1.4.1.</span> <span class="nav-text">1.4.1 execution</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-2-within"><span class="nav-number">1.1.1.4.2.</span> <span class="nav-text">1.4.2 within</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-3-this"><span class="nav-number">1.1.1.4.3.</span> <span class="nav-text">1.4.3 this</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-4-target"><span class="nav-number">1.1.1.4.4.</span> <span class="nav-text">1.4.4 target</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-5-args"><span class="nav-number">1.1.1.4.5.</span> <span class="nav-text">1.4.5 args</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-6-bean"><span class="nav-number">1.1.1.4.6.</span> <span class="nav-text">1.4.6 bean</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-7-annotation"><span class="nav-number">1.1.1.4.7.</span> <span class="nav-text">1.4.7 @annotation</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-8-within"><span class="nav-number">1.1.1.4.8.</span> <span class="nav-text">1.4.8 @within</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-9-target"><span class="nav-number">1.1.1.4.9.</span> <span class="nav-text">1.4.9 @target</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-10-args"><span class="nav-number">1.1.1.4.10.</span> <span class="nav-text">1.4.10 @args</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-4-11-切点表达式组合"><span class="nav-number">1.1.1.4.11.</span> <span class="nav-text">1.4.11 切点表达式组合</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-通知类型与语法"><span class="nav-number">1.1.1.5.</span> <span class="nav-text">1.5 通知类型与语法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-定义驱动AOP实战实例"><span class="nav-number">1.1.2.</span> <span class="nav-text">2.定义驱动AOP实战实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-公共配置自动同步生产AOP"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">2.1 公共配置自动同步生产AOP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-调用外部系统监控AOP"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">2.2 调用外部系统监控AOP</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、Filter过滤器"><span class="nav-number">1.2.</span> <span class="nav-text">二、Filter过滤器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Filter过滤器简介"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.Filter过滤器简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-代码示例"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.代码示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-多个过滤器执行顺序"><span class="nav-number">1.2.3.</span> <span class="nav-text">3.多个过滤器执行顺序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、Interceptor拦截器"><span class="nav-number">1.3.</span> <span class="nav-text">三、Interceptor拦截器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Interceptor拦截器简介"><span class="nav-number">1.3.1.</span> <span class="nav-text">1.Interceptor拦截器简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-代码示例-1"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.代码示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-多个拦截器执行顺序"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.多个拦截器执行顺序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、过滤器、拦截器、SpringAOP、ControllerAdvcie对比与执行顺序"><span class="nav-number">1.4.</span> <span class="nav-text">四、过滤器、拦截器、SpringAOP、ControllerAdvcie对比与执行顺序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-执行顺序"><span class="nav-number">1.4.1.</span> <span class="nav-text">1.执行顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-过滤器、拦截器与RPC浅析"><span class="nav-number">1.4.2.</span> <span class="nav-text">2.过滤器、拦截器与RPC浅析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-京东jsf协议过滤器使用实战"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.京东jsf协议过滤器使用实战</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文献"><span class="nav-number">1.5.</span> <span class="nav-text">参考文献</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zju岩手县小森</span>

  
</div>















        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.ui.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
